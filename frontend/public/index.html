<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tennis Court Reservation</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    :root {
      --primary-color: #1e6751;
      --primary-light: #bfebdf;
      --secondary-color: #f8b400;
      --light-color: #f5f5f5;
      --dark-color: #333333;
      --danger-color: #dc3545;
      --success-color: #198754;
    }
    
    body {
      font-family: 'Montserrat', sans-serif;
      background-color: #f8f9fa;
      color: var(--dark-color);
      padding-top: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .header-bar {
      background-color: var(--primary-color);
      padding: 15px 0;
      color: white;
      margin-bottom: 30px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .header-bar h1 {
      margin: 0;
      font-weight: 600;
      font-size: 1.8rem;
    }
    
    .logo-icon {
      color: var(--secondary-color);
      margin-right: 10px;
    }
    
    .container {
      max-width: 1140px;
      padding: 0 20px;
      flex: 1;
    }
    
    .card {
      border: none;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      margin-bottom: 25px;
      overflow: hidden;
    }
    
    .card-header {
      background-color: var(--primary-color);
      color: white;
      font-weight: 500;
      padding: 15px 20px;
      border: none;
    }
    
    .card-body {
      padding: 25px;
    }
    
    .btn-primary {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }
    
    .btn-primary:hover {
      background-color: #165544;
      border-color: #165544;
    }
    
    .btn-success {
      background-color: var(--success-color);
      border-color: var(--success-color);
    }
    
    .btn-danger {
      background-color: var(--danger-color);
      border-color: var(--danger-color);
    }
    
    .form-control, .form-select {
      padding: 10px 15px;
      border-radius: 8px;
      border: 1px solid #ced4da;
    }
    
    .form-control:focus, .form-select:focus {
      border-color: var(--primary-light);
      box-shadow: 0 0 0 0.25rem rgba(30, 103, 81, 0.25);
    }
    
    .login-register-container {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      overflow: hidden;
    }
    
    .nav-tabs {
      border-bottom: none;
      background-color: #f8f9fa;
    }
    
    .nav-tabs .nav-link {
      border: none;
      color: var(--dark-color);
      font-weight: 500;
      padding: 15px 20px;
      border-radius: 0;
    }
    
    .nav-tabs .nav-link.active {
      background-color: white;
      color: var(--primary-color);
      border-bottom: 3px solid var(--primary-color);
    }
    
    .tab-content {
      padding: 30px;
    }
    
    .table {
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .table thead th {
      background-color: #f8f9fa;
      color: var(--dark-color);
      font-weight: 600;
      border-top: none;
      padding: 12px 15px;
    }
    
    .table tbody td {
      padding: 12px 15px;
      vertical-align: middle;
    }
    
    .table-striped tbody tr:nth-of-type(odd) {
      background-color: rgba(0,0,0,.02);
    }
    
    .status-badge {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 50px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .status-badge.upcoming {
      background-color: var(--primary-light);
      color: var(--primary-color);
    }
    
    .status-badge.completed {
      background-color: #e9ecef;
      color: #6c757d;
    }
    
    .court-card {
      border: 1px solid #ced4da;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .court-card:hover, .court-card.selected {
      border-color: var(--primary-color);
      background-color: var(--primary-light);
    }
    
    .court-card.selected {
      box-shadow: 0 0 0 2px var(--primary-color);
    }
    
    .court-icon {
      color: var(--primary-color);
      margin-right: 10px;
    }

    .court-type {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 50px;
      font-size: 0.7rem;
      font-weight: 600;
      background-color: #e9ecef;
      margin-left: 5px;
    }
    
    .footer {
      background-color: var(--primary-color);
      color: white;
      padding: 20px 0;
      margin-top: 50px;
      text-align: center;
      font-size: 0.9rem;
    }
    
    .alert {
      border-radius: 8px;
      padding: 12px 15px;
    }
    
    .welcome-message {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .welcome-message .avatar {
      width: 40px;
      height: 40px;
      background-color: var(--primary-light);
      color: var(--primary-color);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      margin-right: 10px;
    }
    
    @media (max-width: 768px) {
      .header-bar h1 {
        font-size: 1.5rem;
      }
      
      .card-header {
        padding: 12px 15px;
      }
      
      .card-body {
        padding: 20px 15px;
      }
      
      .tab-content {
        padding: 20px 15px;
      }
    }
  </style>
</head>
<body>
  <div class="header-bar">
    <div class="container">
      <h1><i class="fas fa-table-tennis-paddle-ball logo-icon"></i> Tennis Court Reservation System XXX</h1>
    </div>
  </div>

  <div class="container">
    <!-- Login & Register Section -->
    <div class="login-register-container mb-4">
      <ul class="nav nav-tabs" id="authTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login-tab-pane" type="button" role="tab" aria-controls="login-tab-pane" aria-selected="true">Login</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register-tab-pane" type="button" role="tab" aria-controls="register-tab-pane" aria-selected="false">Register</button>
        </li>
      </ul>
      <div class="tab-content" id="authTabsContent">
        <div class="tab-pane fade show active" id="login-tab-pane" role="tabpanel" aria-labelledby="login-tab" tabindex="0">
          <form id="loginForm">
            <div class="mb-3">
              <label for="username" class="form-label">Username</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-user"></i></span>
                <input type="text" class="form-control" id="username" required>
              </div>
            </div>
            <div class="mb-3">
              <label for="password" class="form-label">Password</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                <input type="password" class="form-control" id="password" required>
              </div>
            </div>
            <button type="submit" class="btn btn-primary w-100">Login <i class="fas fa-sign-in-alt ms-1"></i></button>
            <div id="loginMessage" class="mt-3"></div>
          </form>
        </div>
        <div class="tab-pane fade" id="register-tab-pane" role="tabpanel" aria-labelledby="register-tab" tabindex="0">
          <form id="registerForm">
            <div class="mb-3">
              <label for="regUsername" class="form-label">Username</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-user"></i></span>
                <input type="text" class="form-control" id="regUsername" required>
              </div>
            </div>
            <div class="mb-3">
              <label for="regEmail" class="form-label">Email</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                <input type="email" class="form-control" id="regEmail" required>
              </div>
            </div>
            <div class="mb-3">
              <label for="regPassword" class="form-label">Password</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                <input type="password" class="form-control" id="regPassword" required>
              </div>
            </div>
            <div class="mb-3">
              <label for="regConfirmPassword" class="form-label">Confirm Password</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-check-double"></i></span>
                <input type="password" class="form-control" id="regConfirmPassword" required>
              </div>
            </div>
            <button type="submit" class="btn btn-success w-100">Register <i class="fas fa-user-plus ms-1"></i></button>
            <div id="registerMessage" class="mt-3"></div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Admin Panel -->
    <div id="adminPanel" style="display: none;">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h2 class="m-0"><i class="fas fa-user-shield me-2"></i> Admin Dashboard</h2>
          <button id="logoutBtn" class="btn btn-outline-light btn-sm"><i class="fas fa-sign-out-alt me-1"></i> Logout</button>
        </div>
        <div class="card-body">
          <div class="welcome-message">
            <div class="avatar">
              <i class="fas fa-user-tie"></i>
            </div>
            <div>
              <h4 class="m-0">Welcome, Admin</h4>
              <p class="text-muted m-0">Manage all court reservations</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h3 class="m-0"><i class="fas fa-calendar-check me-2"></i> All Reservations</h3>
        </div>
        <div class="card-body">
          <div id="reservationsList">
            <div class="d-flex justify-content-center">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- User Panel -->
    <div id="userPanel" style="display: none;">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h2 class="m-0"><i class="fas fa-user me-2"></i> User Dashboard</h2>
          <button id="logoutBtnUser" class="btn btn-outline-light btn-sm"><i class="fas fa-sign-out-alt me-1"></i> Logout</button>
        </div>
        <div class="card-body">
          <div class="welcome-message">
            <div class="avatar" id="userAvatar">U</div>
            <div>
              <h4 class="m-0" id="welcomeUsername">Welcome</h4>
              <p class="text-muted m-0">Book and manage your reservations</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h3 class="m-0"><i class="fas fa-calendar-plus me-2"></i> Book a Court</h3>
        </div>
        <div class="card-body">
          <form id="bookingForm">
            <div class="mb-4">
              <label for="courtSelect" class="form-label">Select Court</label>
              <select class="form-select" id="courtSelect" required>
                <option value="">Select a court</option>
              </select>
            </div>
            
            <div class="row">
              <div class="col-md-6 mb-4">
                <label for="dateSelect" class="form-label">Select Date</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                  <input type="date" class="form-control" id="dateSelect" required>
                </div>
              </div>
              <div class="col-md-6 mb-4">
                <label for="timeSelect" class="form-label">Select Time</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-clock"></i></span>
                  <select class="form-select" id="timeSelect" required>
                    <option value="">Select a time</option>
                    <option value="08:00">8:00 AM</option>
                    <option value="09:00">9:00 AM</option>
                    <option value="10:00">10:00 AM</option>
                    <option value="11:00">11:00 AM</option>
                    <option value="12:00">12:00 PM</option>
                    <option value="13:00">1:00 PM</option>
                    <option value="14:00">2:00 PM</option>
                    <option value="15:00">3:00 PM</option>
                    <option value="16:00">4:00 PM</option>
                    <option value="17:00">5:00 PM</option>
                    <option value="18:00">6:00 PM</option>
                    <option value="19:00">7:00 PM</option>
                  </select>
                </div>
              </div>
            </div>
            
            <button type="submit" class="btn btn-success"><i class="fas fa-check-circle me-1"></i> Book Court</button>
            <div id="bookingMessage" class="mt-3"></div>
          </form>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h3 class="m-0"><i class="fas fa-list-check me-2"></i> My Reservations</h3>
        </div>
        <div class="card-body">
          <div id="myReservationsList">
            <div class="d-flex justify-content-center">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <footer class="footer">
    <div class="container">
      <p class="m-0">© 2025 Tennis Court Reservation System. All rights reserved.</p>
    </div>
  </footer>
  
  <script>
    const API_URL = 'http://localhost:5000/api';
    let token = localStorage.getItem('token');
    let user = null;
    
    // DOM Elements
    const loginForm = document.getElementById('loginForm');
    const loginMessage = document.getElementById('loginMessage');
    const registerForm = document.getElementById('registerForm');
    const registerMessage = document.getElementById('registerMessage');
    const adminPanel = document.getElementById('adminPanel');
    const userPanel = document.getElementById('userPanel');
    const reservationsList = document.getElementById('reservationsList');
    const myReservationsList = document.getElementById('myReservationsList');
    const courtSelect = document.getElementById('courtSelect');
    const bookingForm = document.getElementById('bookingForm');
    const bookingMessage = document.getElementById('bookingMessage');
    const logoutBtn = document.getElementById('logoutBtn');
    const logoutBtnUser = document.getElementById('logoutBtnUser');
    const dateSelect = document.getElementById('dateSelect');
    const userAvatar = document.getElementById('userAvatar');
    const welcomeUsername = document.getElementById('welcomeUsername');
    const authTabs = document.querySelector('.login-register-container');
    
    // Set min date to today
    const today = new Date().toISOString().split('T')[0];
    dateSelect.min = today;
    
    // Set max date to 30 days from today
    const maxDate = new Date();
    maxDate.setDate(maxDate.getDate() + 30);
    dateSelect.max = maxDate.toISOString().split('T')[0];
    
    // Format date and time
    function formatDateTime(dateTimeString) {
      const options = { 
        weekday: 'long',
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      };
      return new Date(dateTimeString).toLocaleDateString(undefined, options);
    }
    
    // Get avatar initial
    function getInitial(username) {
      return username ? username.charAt(0).toUpperCase() : 'U';
    }
    
    // Check if user is logged in
    async function checkLogin() {
      if (token) {
        try {
          const response = await fetch(`${API_URL}/users/profile`, {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          if (response.ok) {
            user = await response.json();
            
            if (user.isAdmin) {
              adminPanel.style.display = 'block';
              authTabs.style.display = 'none';
              fetchAllReservations();
            } else {
              userPanel.style.display = 'block';
              authTabs.style.display = 'none';
              userAvatar.textContent = getInitial(user.username);
              welcomeUsername.textContent = `Welcome, ${user.username}`;
              fetchCourts();
              fetchUserReservations();
            }
          } else {
            localStorage.removeItem('token');
            token = null;
          }
        } catch (error) {
          console.error('Error checking login:', error);
          localStorage.removeItem('token');
          token = null;
        }
      }
    }
    
    // Login form submission
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      
      try {
        loginMessage.innerHTML = '<div class="alert alert-info">Logging in...</div>';
        
        const response = await fetch(`${API_URL}/users/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ username, password })
        });
        
        if (response.ok) {
          const data = await response.json();
          token = data.token;
          localStorage.setItem('token', token);
          user = data;
          
          if (data.isAdmin) {
            adminPanel.style.display = 'block';
            authTabs.style.display = 'none';
            fetchAllReservations();
          } else {
            userPanel.style.display = 'block';
            authTabs.style.display = 'none';
            userAvatar.textContent = getInitial(user.username);
            welcomeUsername.textContent = `Welcome, ${user.username}`;
            fetchCourts();
            fetchUserReservations();
          }
          
          loginMessage.innerHTML = '';
        } else {
          const errorData = await response.json();
          loginMessage.innerHTML = `<div class="alert alert-danger">${errorData.message || 'Login failed'}</div>`;
        }
      } catch (error) {
        console.error('Login error:', error);
        loginMessage.innerHTML = '<div class="alert alert-danger">Login failed. Please try again.</div>';
      }
    });
    
    // Fetch all reservations (admin only)
    async function fetchAllReservations() {
      try {
        reservationsList.innerHTML = `
          <div class="d-flex justify-content-center">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        `;
        
        const response = await fetch(`${API_URL}/reservations/all`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (response.ok) {
          const reservations = await response.json();
          
          if (reservations.length === 0) {
            reservationsList.innerHTML = '<p class="text-center text-muted">No reservations found.</p>';
          } else {
            let html = '<div class="table-responsive">';
            html += '<table class="table table-striped">';
            html += '<thead><tr><th>User</th><th>Court</th><th>Date & Time</th><th>Status</th><th>Actions</th></tr></thead>';
            html += '<tbody>';
            
            reservations.forEach(reservation => {
              const isPast = new Date(reservation.start_time) < new Date();
              const status = isPast ? 
                '<span class="status-badge completed">Completed</span>' : 
                '<span class="status-badge upcoming">Upcoming</span>';
              
              html += `<tr>
                <td><i class="fas fa-user me-2 text-muted"></i>${reservation.username}</td>
                <td><i class="fas fa-table-tennis-paddle-ball me-2 text-muted"></i>${reservation.court_name}</td>
                <td><i class="fas fa-calendar-day me-2 text-muted"></i>${formatDateTime(reservation.start_time)}</td>
                <td>${status}</td>
                <td>${!isPast ? 
                  `<button class="btn btn-sm btn-danger cancel-btn" data-id="${reservation.id}"><i class="fas fa-times me-1"></i>Cancel</button>` : 
                  '<span class="text-muted">No actions</span>'}
                </td>
              </tr>`;
            });
            
            html += '</tbody></table></div>';
            reservationsList.innerHTML = html;
            
            // Add event listeners to cancel buttons
            document.querySelectorAll('.cancel-btn').forEach(button => {
              button.addEventListener('click', async () => {
                const id = button.getAttribute('data-id');
                if (confirm('Are you sure you want to cancel this reservation?')) {
                  button.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Cancelling...';
                  button.disabled = true;
                  await cancelReservation(id);
                  fetchAllReservations();
                }
              });
            });
          }
        } else {
          reservationsList.innerHTML = '<div class="alert alert-danger">Failed to load reservations.</div>';
        }
      } catch (error) {
        console.error('Error fetching reservations:', error);
        reservationsList.innerHTML = '<div class="alert alert-danger">Failed to load reservations.</div>';
      }
    }
    
    // Fetch user reservations
    async function fetchUserReservations() {
      try {
        myReservationsList.innerHTML = `
          <div class="d-flex justify-content-center">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        `;
        
        const response = await fetch(`${API_URL}/reservations`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (response.ok) {
          const reservations = await response.json();
          
          if (reservations.length === 0) {
            myReservationsList.innerHTML = '<p class="text-center text-muted">You have no reservations. Book a court to get started!</p>';
          } else {
            let html = '<div class="table-responsive">';
            html += '<table class="table table-striped">';
            html += '<thead><tr><th>Court</th><th>Date & Time</th><th>Status</th><th>Actions</th></tr></thead>';
            html += '<tbody>';
            
            reservations.forEach(reservation => {
              const isPast = new Date(reservation.start_time) < new Date();
              const status = isPast ? 
                '<span class="status-badge completed">Completed</span>' : 
                '<span class="status-badge upcoming">Upcoming</span>';
              
              html += `<tr>
                <td><i class="fas fa-table-tennis-paddle-ball me-2 text-muted"></i>${reservation.court_name}</td>
                <td><i class="fas fa-calendar-day me-2 text-muted"></i>${formatDateTime(reservation.start_time)}</td>
                <td>${status}</td>
                <td>${!isPast ? 
                  `<button class="btn btn-sm btn-danger user-cancel-btn" data-id="${reservation.id}"><i class="fas fa-times me-1"></i>Cancel</button>` : 
                  '<span class="text-muted">No actions</span>'}
                </td>
              </tr>`;
            });
            
            html += '</tbody></table></div>';
            myReservationsList.innerHTML = html;
            
            // Add event listeners to cancel buttons
            document.querySelectorAll('.user-cancel-btn').forEach(button => {
              button.addEventListener('click', async () => {
                const id = button.getAttribute('data-id');
                if (confirm('Are you sure you want to cancel this reservation?')) {
                  button.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Cancelling...';
                  button.disabled = true;
                  await cancelReservation(id);
                  fetchUserReservations();
                }
              });
            });
          }
        } else {
          myReservationsList.innerHTML = '<div class="alert alert-danger">Failed to load your reservations.</div>';
        }
      } catch (error) {
        console.error('Error fetching user reservations:', error);
        myReservationsList.innerHTML = '<div class="alert alert-danger">Failed to load your reservations.</div>';
      }
    }
    
    // Fetch courts
    async function fetchCourts() {
      try {
        const response = await fetch(`${API_URL}/courts`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (response.ok) {
          const courts = await response.json();
          
          courtSelect.innerHTML = '<option value="">Select a court</option>';
          
          courts.forEach(court => {
            const indoorIcon = court.is_indoor ? 
              '<i class="fas fa-home ms-1" title="Indoor"></i>' : 
              '<i class="fas fa-sun ms-1" title="Outdoor"></i>';
            
            courtSelect.innerHTML += `<option value="${court.id}">${court.name} - ${court.surface} ${indoorIcon}</option>`;
          });
        } else {
          courtSelect.innerHTML = '<option value="">Failed to load courts</option>';
        }
      } catch (error) {
        console.error('Error fetching courts:', error);
        courtSelect.innerHTML = '<option value="">Failed to load courts</option>';
      }
    }
    
    // Book a court
    bookingForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const courtId = courtSelect.value;
      const date = dateSelect.value;
      const time = document.getElementById('timeSelect').value;
      
      if (!courtId || !date || !time) {
        bookingMessage.innerHTML = '<div class="alert alert-danger">Please fill all fields.</div>';
        return;
      }
      
      // Create start and end times (1 hour apart)
      const startTime = new Date(`${date}T${time}`);
      const endTime = new Date(startTime);
      endTime.setHours(endTime.getHours() + 1);
      
      try {
        bookingMessage.innerHTML = '<div class="alert alert-info">Booking your court...</div>';
        
        const response = await fetch(`${API_URL}/reservations`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({
            courtId,
            startTime: startTime.toISOString(),
            endTime: endTime.toISOString()
          })
        });
        
        if (response.ok) {
          bookingMessage.innerHTML = '<div class="alert alert-success"><i class="fas fa-check-circle me-2"></i>Court booked successfully!</div>';
          bookingForm.reset();
          fetchUserReservations();
        } else {
          const errorData = await response.json();
          bookingMessage.innerHTML = `<div class="alert alert-danger"><i class="fas fa-exclamation-circle me-2"></i>${errorData.message || 'Failed to book court'}</div>`;
        }
      } catch (error) {
        console.error('Booking error:', error);
        bookingMessage.innerHTML = '<div class="alert alert-danger"><i class="fas fa-exclamation-circle me-2"></i>Failed to book court. Please try again.</div>';
      }
    });
    
    // Cancel a reservation
    async function cancelReservation(id) {
      try {
        const response = await fetch(`${API_URL}/reservations/${id}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (!response.ok) {
          alert('Failed to cancel reservation.');
        }
      } catch (error) {
        console.error('Error cancelling reservation:', error);
        alert('Failed to cancel reservation.');
      }
    }
    
    // Logout
    function logout() {
      localStorage.removeItem('token');
      token = null;
      user = null;
      adminPanel.style.display = 'none';
      userPanel.style.display = 'none';
      authTabs.style.display = 'block';
    }
    
    // Register form submission
    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const username = document.getElementById('regUsername').value;
      const email = document.getElementById('regEmail').value;
      const password = document.getElementById('regPassword').value;
      const confirmPassword = document.getElementById('regConfirmPassword').value;
      
      if (password !== confirmPassword) {
        registerMessage.innerHTML = '<div class="alert alert-danger"><i class="fas fa-exclamation-circle me-2"></i>Passwords do not match</div>';
        return;
      }
      
      try {
        registerMessage.innerHTML = '<div class="alert alert-info">Creating your account...</div>';
        
        const response = await fetch(`${API_URL}/users`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ username, email, password })
        });
        
        if (response.ok) {
          const data = await response.json();
          registerMessage.innerHTML = '<div class="alert alert-success"><i class="fas fa-check-circle me-2"></i>Registration successful! You can now log in.</div>';
          registerForm.reset();
          
          // Auto-fill the login form and switch to login tab
          document.getElementById('username').value = username;
          document.getElementById('password').value = password;
          
          // Switch to login tab
          const loginTab = document.getElementById('login-tab');
          bootstrap.Tab.getInstance(loginTab) || new bootstrap.Tab(loginTab);
          loginTab.click();
        } else {
          const errorData = await response.json();
          registerMessage.innerHTML = `<div class="alert alert-danger"><i class="fas fa-exclamation-circle me-2"></i>${errorData.message || 'Registration failed'}</div>`;
        }
      } catch (error) {
        console.error('Registration error:', error);
        registerMessage.innerHTML = '<div class="alert alert-danger"><i class="fas fa-exclamation-circle me-2"></i>Registration failed. Please try again.</div>';
      }
    });
    
    logoutBtn.addEventListener('click', logout);
    logoutBtnUser.addEventListener('click', logout);
    
    // Check login on page load
    checkLogin();
  </script>
</body>
</html>